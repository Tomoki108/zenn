---
title: "[èª­æ›¸ãƒ¡ãƒ¢] System Design Interview â€“ An insider's guide"
emoji: "ğŸ§™ğŸ¼â€â™‚ï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["èª­æ›¸ãƒ¡ãƒ¢", "ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£"]
published: false
---

ã‚·ã‚¹ãƒ†ãƒ ãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼å¯¾ç­–ï¼‰ã«é–¢ã™ã‚‹ãƒ™ã‚¹ãƒˆã‚»ãƒ©ãƒ¼ã®ã€å€‹äººçš„èª­æ›¸ãƒ¡ãƒ¢ã€‚
[amazon ãƒªãƒ³ã‚¯](https://www.amazon.co.jp/-/en/Alex-Xu/dp/B08CMF2CQF)

# Chapter 1: Scale From Zero To Millions Of Users

**å…¨ã¦ã® tier ã§å†—é•·æ€§ã¨å¯ç”¨æ€§ã‚’é«˜ã‚ã‚‹ã¹ã—ã€‚ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ã‚‚ä½ãã™ã¹ã—ã€‚**

- ã‚µãƒ¼ãƒãƒ¼ã¯ 1 å°å›ºå®šã§ã¯ãªãæœ€ä½ 2 å°ä»¥ä¸Šã‚’èµ·å‹•ã•ã›ã€**ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼**ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŒ¯ã‚Šåˆ†ã‘ã‚‹ã€‚

  - è² è·ã«å¿œã˜ã¦å°æ•°ã‚’å¢—ã‚„ã™ã€‚ï¼ˆ**ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°**ï¼‰
  - ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã® public ip ã®ã¿å…¬é–‹ã—ã€ã‚µãƒ¼ãƒãƒ¼è‡ªä½“ã¯ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã‹ã‚‰ private ip ã«ã‚ˆã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã€‚

- DB ã¯ **primary/standby** æ§‹æˆã«ã—ã€å‰è€…ã« write ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã€å¾Œè€…ã« read ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŒ¯ã‚Šåˆ†ã‘ã€primary=>secondary ã®**ãƒ‡ãƒ¼ã‚¿ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**ã‚’è¡Œã†ã€‚

  - primary ã«éšœå®³ãŒã‚ã‚Œã° standby ã‚’ primary ã«æ˜‡æ ¼ã•ã›ã€standby ã‚’å¢—ã‚„ã™ã€‚standby ã«éšœå®³ãŒã‚ã‚Œã°ã€standby ã‚’å¢—ã‚„ã™ã€‚

- DB ã¸é »ç¹ã«å•ã„åˆã‚ã›ã‚‰ã‚Œã€ã‹ã¤æ›´æ–°é »åº¦ã®ä½ã„ãƒ‡ãƒ¼ã‚¿ã¯ã€**ã‚­ãƒ£ãƒƒã‚·ãƒ¥**ã‚·ã‚¹ãƒ†ãƒ ã«ä¿å­˜ã™ã‚‹ã€‚

  - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã¯é©åˆ‡ãªæœ‰åŠ¹æœŸé™ã‚’è¨­å®šã™ã‚‹ã€‚
  - å•ã„åˆã‚ã›ã«å¯¾ã—ã¦ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒã‚ã‚Œã°ãã‚Œã‚’è¿”ã—ã€ãªã‘ã‚Œã° DB ã«å•ã„åˆã‚ã›ãã‚Œã‚’è¿”ã™ã€‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã‚‚ä¿å­˜ã™ã‚‹ã€‚
  - DB æ›´æ–°ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æ›´æ–°ã¯ã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç”¨ã„æ•´åˆæ€§ãŒå¸¸ã«ä¿ãŸã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

- é™çš„ãƒ‡ãƒ¼ã‚¿ï¼ˆHTMLã€CSSã€JSï¼‰ã¯ **CDNï¼ˆContents Delivery Networkï¼‰** ã§æä¾›ã™ã‚‹ã€‚

  - CDN ã®ä¸–ç•Œå„åœ°ã®ã‚µãƒ¼ãƒãƒ¼ã®ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æœ€ã‚‚è¿‘ã„ã‚‚ã®ã‹ã‚‰è‡ªå‹•ã§é…ä¿¡ã§ãã‚‹ã€‚

- ã‚µãƒ¼ãƒãƒ¼ã¯**ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹**ã«ã™ã‚‹ã€‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èªè¨¼æƒ…å ±ï¼‰ã‚’ã‚µãƒ¼ãƒãƒ¼å†…ã® RAM ã‚„ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«ä¿å­˜ã—ãªã„ã€‚ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã‚„ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼ã®éšœå®³ã«ãªã‚‹ã€‚

  - ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ãªã©ã¯å¤–éƒ¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã™ã‚‹ã€‚é€Ÿåº¦ãŒæ±‚ã‚ã‚‰ã‚Œã‚‹ã®ã§ NoSQL ã‚‚æœ‰åŠ›ã€‚

- ã‚·ã‚¹ãƒ†ãƒ ç¾¤ã¯ã€è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ã«å†—é•·åŒ–ã™ã‚‹ã€‚DB ç­‰ã¯ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¦ç”Ÿåˆæˆã‚’ä¿ã¤ã€‚

  - ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åœ°ç†ã«ã‚ˆã£ã¦é©åˆ‡ãªãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ã€‚ï¼ˆ**GeoDNS-routed**ï¼‰

- ãƒãƒƒãƒå‡¦ç†ã¯ã€Worker ã‚µãƒ¼ãƒãƒ¼ã‚’ç”¨æ„ã—ã€API ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰**ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼**ã‚’ä»‹ã—ã¦ã‚¿ã‚¹ã‚¯ã«å–ã‚Šçµ„ã‚€ã€‚API ã‚µãƒ¼ãƒãƒ¼ã¨ã¯ç‹¬ç«‹ã—ã¦ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚

- ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã„ã‚ã‚‰ã‚†ã‚‹ãƒ­ã‚°ã‚’åé›†ã—ã€ãƒ›ã‚¹ãƒˆãƒ¬ãƒ™ãƒ«ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆex, CPU usageï¼‰ã€é›†ç´„ãƒ¬ãƒ™ãƒ«ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆex, DB tier performanceï¼‰ã€KPIï¼ˆex, åç›Šã€CRï¼‰ãªã©ã®**ãƒ¡ãƒˆãƒªã‚¯ã‚¹**ã‚’ç›£è¦–ã™ã‚‹ã€‚è¦‹ã‚„ã™ã„ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ä½œã‚‹ã€‚

- DB ã‚’**ã‚·ãƒ£ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°**ã«ã‚ˆã£ã¦æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã™ã‚‹ã€‚DB ã‚’ã‚·ãƒ£ãƒ¼ãƒ‰ã¨ã„ã†å˜ä½ã«åˆ†å‰²ã—ã€ãƒ‡ãƒ¼ã‚¿ã‚’é©åˆ‡ãªãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ï¼ˆex, idï¼‰ã‹ã‚‰ç”Ÿæˆã—ãŸ ãƒãƒƒã‚·ãƒ¥ã«ã‚ˆã£ã¦ã€ã©ã®ã‚·ãƒ£ãƒ¼ãƒ‰ã«æ ¼ç´ã™ã‚‹ã‹åˆ‡ã‚Šåˆ†ã‘ã‚‹ã€‚é«˜é€Ÿãªãƒ‡ãƒ¼ã‚¿ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒå¯èƒ½ã«ãªã‚‹ã€‚
  - ãƒ‡ãƒ¼ã‚¿ã®å¢—åŠ ã«å¿œã˜ã¦ã‚·ãƒ£ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ãŸã‚Šã€æ—¢å­˜ã®ã‚·ãƒ£ãƒ¼ãƒ‰ã‚’æ›´ã«åˆ†å‰²ã™ã‚‹ã¨ãã¯**ãƒªã‚·ãƒ£ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°**ï¼ˆãƒ‡ãƒ¼ã‚¿ã®å†é…ç½®ï¼‰ã‚’è¡Œã†ã€‚
  - ã‚·ãƒ£ãƒ¼ãƒ‰ã«ã¾ãŸãŒã‚‹ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—é€£çµã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã—ãŸããªã£ãŸã¨ãã¯ã€DB ã®éæ­£è¦åŒ–ã§ã‚·ãƒ£ãƒ¼ãƒ‰å†…ã§ãƒ‡ãƒ¼ã‚¿ãŒå®Œçµã™ã‚‹ã‚ˆã†ã«ã—ãŸã‚Šã€**ãƒãƒ†ãƒªã‚¢ãƒ©ã‚¤ã‚ºãƒ‰ãƒ“ãƒ¥ãƒ¼**ã‚’ç”¨æ„ã—ãŸã‚Šã—ã¦ãŠãã€‚

# Chapter 2: Back-of-the-envelope Estimation

## è¦šãˆã‚‹ã¹ãæ•°å­—

- 2 ã®ä¹—æ•°ã€ãƒã‚¤ãƒˆå˜ä½ã«ã¤ã„ã¦è¦šãˆã¾ã—ã‚‡ã†ã€‚
  ::: details è¡¨
  ![image](/images/202502_system_design/chapter2_power_of_two.png)
  :::

- ä¸»è¦ãªãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ã‚’è¦šãˆã¾ã—ã‚‡ã†ã€‚
  ::: details è¡¨
  ![image](/images/202502_system_design/chapter2_latency.png)
  :::

- **é‡è¦**
  - ãƒ¡ãƒ¢ãƒªã‚¢ã‚¯ã‚»ã‚¹ã¯æ—©ã„ãŒãƒ‡ã‚£ã‚¹ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã¯é…ã„ã€‚ãƒ‡ã‚£ã‚¹ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã¯å¯èƒ½ãªé™ã‚Šé¿ã‘ã‚‹ã€‚
  - å˜ç´”ãªåœ§ç¸®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯æ—©ã„ã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¶Šã—ã®ãƒ‡ãƒ¼ã‚¿è»¢é€ã¯å¯èƒ½ãªã‚‰äº‹å‰ã«åœ§ç¸®ã‚’ã€‚
  - ç•°ãªã‚‹ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼é–“ã®é€šä¿¡ã¯æ™‚é–“ãŒã‹ã‹ã‚‹ã€‚

### QPS(Query Per Seconds)ã®è¦‹ç©ã‚‚ã‚Š

Ex, Twitter

Given:

- 300 million monthly active users.
- 50% of users use Twitter daily.
- Users post 2 tweets per day on average.
- 10% of tweets contain media.
- Data is stored for 5 years.
- Average tweet size:
  - tweet_id 64 bytes
  - text 140 bytes
  - media 1 MB

Estimations:

- **Daily active users (DAU)**: `300 million * 50% = 150 million`
- Tweets QPS: `150 million * 2 tweets / 24 hour / 3600 seconds = ~3500`
- Peak QPS: `2 * QPS = ~7000`
- Media storage: `150 million * 2 * 10% * 1 MB = 30 TB per day`
- 5-year media storage: `30 TB * 365 * 5 = ~55 PB`

#### Tips

- è¨ˆç®—çµæœã‚’ãƒ¡ãƒ¢ã«æ›¸ãã€‚
- æ•°å­—ã‚’ä¸¸ã‚ã‚‹ã€‚
- å‰æã¨ã—ã¦ãƒã‚¤ãƒˆã®å¤‰æ›ç­‰ã«æ…£ã‚Œã¦ãŠãã€‚
- **QPS, peak QPS, storage, cache**ãªã©ãŒã‚ˆãèã‹ã‚Œã‚‹ã€‚

# Chapter 3: A Framework For System Design Interviews

## step1. å•é¡Œã‚’èªè­˜ã—ã¦è¨­è¨ˆã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’æ˜ç¢ºã«ã™ã‚‹ / 3~10 min

ã€Œãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ•ã‚£ãƒ¼ãƒ‰ã‚’è¨­è¨ˆã—ã¦ãã ã•ã„ã€

- web or mobile? both?
- æœ€ä½é™ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¯ä½•ï¼Ÿ
- Daily Active User ã®æ•°ã¯ï¼Ÿ
- æ©Ÿèƒ½ã®è©³ç´°

  - ãƒ•ã‚£ãƒ¼ãƒ‰ã¯å‹é”ã®è¨˜äº‹ï¼Ÿæ™‚ç³»åˆ—é †ï¼Ÿä½•ã‚‰ã‹ã®é‡ã¿é †ï¼Ÿ
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å‹é”ã‚’ä½•äººã‚‚ã¦ã‚‹ï¼Ÿ
  - ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¯ãƒ†ã‚­ã‚¹ãƒˆï¼Ÿã‚¤ãƒ¡ãƒ¼ã‚¸ã‚„ãƒ“ãƒ‡ã‚ªã‚’å«ã‚€ï¼Ÿ

## step2. å…¨ä½“è¨­è¨ˆã‚’ææ¡ˆã—åŒæ„ã‚’å¾—ã‚‹ / 10~15 min

::: details ã“ã®ãã‚‰ã„ã®å…¨ä½“è¨­è¨ˆã‚’ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰ã«æ›¸ã
![image](/images/202502_system_design/chapter3_blueprint.png)
:::

## step3. è©³ç´°ã‚’è¨­è¨ˆã™ã‚‹ / 10~25 min

ã©ã®éƒ¨åˆ†ã‚’è©³ç´°ã«è¨­è¨ˆã—ã¦æ¬²ã—ã„ã®ã‹æ˜ç¢ºã«ã™ã‚‹ã€‚

é‡è¦ãªãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã€‚ex, ã€Œãƒ‹ãƒ¥ãƒ¼ã‚¹ã®æŠ•ç¨¿ã€ã€Œãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ•ã‚£ãƒ¼ãƒ‰ã®å–å¾—ã€
ã‚ã‚‹ã„ã¯é‡è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€‚ex, ã€Œãƒ•ã‚£ãƒ¼ãƒ‰ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€ã€Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ¬ãƒ¼ãƒˆãƒªãƒŸãƒƒã‚¿ãƒ¼ã€

::: details å…¨ä½“è¨­è¨ˆã«æ›¸ãè¶³ã™
![image](/images/202502_system_design/chapter3_detailed_blueprint.png)
:::

## step4. Wrap Up / 3~5 min

ã“ã‚Œã¾ã§ã«ä½œã£ãŸè¨­è¨ˆã‚’ã‚‚ã†ä¸€åº¦èª¬æ˜ã—ã¦æŒ¯ã‚Šè¿”ã‚‹ã¨è‰¯ã„ã€‚

ã¾ãŸã€æœ€å¾Œã«ä»¥ä¸‹ã®æ§˜ãªã“ã¨ãŒèã‹ã‚Œã‚‹ã“ã¨ãŒå¤šã„ã€‚

- ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã¨æ”¹å–„ãƒã‚¤ãƒ³ãƒˆ
- ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã‹ã‚‰ã®å¾©å¸°
- é‹ç”¨ã®å•é¡Œã€‚ã©ã®æ§˜ã«ãƒ­ã‚°ã‚’å–ã£ã¦ç›£è¦–ã™ã‚‹ï¼Ÿæ–°æ©Ÿèƒ½ã¯ã©ã®æ§˜ã«ãƒªãƒªãƒ¼ã‚¹ï¼ˆãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆï¼‰ã™ã‚‹ï¼Ÿ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ 10 å€ã«ãªã£ãŸã‚‰ã©ã†ã™ã‚‹ï¼Ÿ

## Dos

- ç¢ºèªã®ãŸã‚ã«å¸¸ã«è³ªå•ã‚’ã€‚å‹æ‰‹ã«å‰æã‚’ç½®ã‹ãªã„ã€‚
- è¦ä»¶ã‚’ç†è§£ã™ã‚‹ã€‚ä¸ç¢ºã‹ãªã¾ã¾é€²ã‚ãªã„ã€‚
- å¯èƒ½ãªã‚‰è¤‡æ•°ã®ææ¡ˆã‚’ã€‚ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ã‚¢ãƒ¼ã«ã¶ã¤ã‘ã‚ˆã†ã€‚ï¼ˆã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ã‚¢ãƒ¼ã¯ä»²é–“ã€‚ï¼‰
- **å…¨ä½“è¨­è¨ˆã«åˆæ„ã—ã¦ã‹ã‚‰**ã€é‡è¦ãªå ´æ‰€ã®è©³ç´°è¨­è¨ˆã«å…¥ã‚‹ã€‚

## Dont's

- **å…¸å‹çš„ãªè³ªå•ã¸ã®å¯¾ç­–ã¯æ€ ã‚‰ãªã„ã€‚**
- è¦ä»¶ã‚„æœŸå¾…ã‚’ç¢ºèªã™ã‚‹ã¾ã§ã€ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚¸ãƒ£ãƒ³ãƒ—ã—ãªã„ã€‚
- è³ªå•ã‚’è‡†ã•ãªã„ã€é»™ã£ã¦è€ƒãˆãªã„ã€‚
- ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ã‚¢ãƒ¼ãŒçµ‚ã‚ã‚Šã¨ã„ã†ã¾ã§çµ‚ã‚ã‚‰ãªã„ã€‚

# Chapter 4: Design A Rate Limiter

## step1. å•é¡Œã‚’èªè­˜ã—ã¦è¨­è¨ˆã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’æ˜ç¢ºã«ã™ã‚‹ / 3~10 min

- server side or client side?
  - => sever side
- ä½•ã§ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã™ã‚‹ï¼ŸIPã€UserIDï¼Ÿ
  - => up to you
- ã‚·ã‚¹ãƒ†ãƒ ã®ã‚¹ã‚±ãƒ¼ãƒ«ã¯ï¼Ÿã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ï¼Ÿå·¨å¤§ãªã‚·ã‚¹ãƒ†ãƒ ï¼Ÿ
  - => å¤§è¦æ¨¡ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚‚å¯¾å¿œã§ãã‚‹æ§˜ã«ã—ã¦ã€‚
- åˆ†æ•£å‹ã‚·ã‚¹ãƒ†ãƒ ã§ã‚‚æ©Ÿèƒ½ã™ã‚‹å¿…è¦ã¯ã‚ã‚‹ï¼Ÿ
  - => yes
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ¬ãƒ¼ãƒˆåˆ¶é™ä¸­ã¨ä¼ãˆã‚‹å¿…è¦ã¯ã‚ã‚‹ï¼Ÿ
  - => yes

## step2. å…¨ä½“è¨­è¨ˆã‚’ææ¡ˆã—åŒæ„ã‚’å¾—ã‚‹ / 10~15 min

### ã©ã“ã«ãƒ¬ãƒ¼ãƒˆãƒªãƒŸãƒƒã‚¿ãƒ¼ã‚’ç½®ãã‹

- ã‚µãƒ¼ãƒãƒ¼
  - å®Ÿè£…ãŒå¿…è¦ã ãŒãƒªãƒŸãƒƒã‚¿ãƒ¼ã®æŒ™å‹•ã‚’æ¯”è¼ƒçš„è‡ªç”±ã«ã§ãã‚‹ã€‚åˆ†æ•£ã‚·ã‚¹ãƒ†ãƒ ã¨ç›¸æ€§ãŒæ‚ªã„ã€‚
- ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼ˆå¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ï¼‰
  - æ¥½ã€‚åˆ©ç”¨ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚ˆã£ã¦ã¯ãƒªãƒŸãƒƒã‚¿ãƒ¼ã®æŒ™å‹•ãŒé™ã‚‰ã‚ŒãŸã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ãªã‚‹ã€‚åˆ†æ•£ã‚·ã‚¹ãƒ†ãƒ ã¨ç›¸æ€§ãŒè‰¯ã„ã€‚

### ã©ã“ã«ãƒ¬ãƒ¼ãƒˆãƒªãƒŸãƒƒãƒˆç”¨ã®ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ï¼ˆã¾ãŸã¯ãƒ­ã‚°ãªã©ï¼‰ã‚’ä¿å­˜ã™ã‚‹ã‹

- DB ã¯é©ã•ãªã„ã€‚ãƒ‡ã‚£ã‚¹ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã¯é…ã„ã€‚
- In-Memory Cache ï¼ˆRedis ãªã©ï¼‰ãŒé©å½“ã€‚ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€å®šæœŸé–“ã§ expired ã«ã‚‚ã§ãã‚‹ã€‚

::: details blueprint
![image](/images/202502_system_design/chapter4_blueprint.png)
:::

## step3. è©³ç´°ã‚’è¨­è¨ˆã™ã‚‹ / 10~25 min

### ãƒ¬ãƒ¼ãƒˆãƒªãƒŸãƒƒãƒˆã®ãƒ«ãƒ¼ãƒ«ã¯ã©ã“ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ï¼Ÿ

- ä½•ã‚‰ã‹ã®æ°¸ç¶šåŒ–ãƒ‡ã‚£ã‚¹ã‚¯ã«ä¿å­˜ã™ã‚‹ã€‚Worker ãŒå®šæœŸçš„ã«ãƒ‡ã‚£ã‚¹ã‚¯ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½œæˆã™ã‚‹ã€‚ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‚ç…§ã™ã‚‹ã€‚

### ãƒªãƒŸãƒƒãƒˆã‚ªãƒ¼ãƒãƒ¼ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¯ã©ã†ãªã‚‹ï¼Ÿ

- ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãŒ Redis ã«ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ç­‰ã®æƒ…å ±ã‚’å–å¾—ã€‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—ã—ãŸãƒ«ãƒ¼ãƒ«ã¨ç…§åˆã—ã¦ã€
  - ãƒªãƒŸãƒƒãƒˆã‚ªãƒ¼ãƒãƒ¼ãªã‚‰ 429ã€‚header ã«`X-Ratelimit-Retry-After`ãªã©ã‚’ä»˜ä¸ã€‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆè‡ªä½“ã¯ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹ã‹ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼ã«å…¥ã‚Œã‚‹ã€‚ï¼ˆè¦ä»¶æ¬¡ç¬¬ã€‚ï¼‰
  - ã‚ªãƒ¼ãƒãƒ¼ã—ã¦ã„ãªã„ãªã‚‰ã‚µãƒ¼ãƒãƒ¼ã¸å‡¦ç†ã‚’é€²ã‚ã‚‹ã€‚Redis ã¸ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ç­‰ã‚‚è¨˜éŒ²ã™ã‚‹ã€‚ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã«`X-Ratelimit-Remaining`, `X-Ratelimit-Limit`ãªã©ã‚’ä»˜ä¸ã™ã‚‹ã€‚

::: details detailed blueprint
![imgae](/images/202502_system_design/chapter4_detailed_blueprint.png)
:::

### åˆ†æ•£ã‚·ã‚¹ãƒ†ãƒ ã ã£ãŸã¨ã—ã¦ã€æ°—ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã“ã¨ã¯ï¼Ÿ

- çŠ¶æ…‹ã®ç«¶åˆï¼ˆRace Conditionï¼‰ã€‚Dirty Read ãªã©ã€‚transaction lock ã™ã‚‹ã®ãŒã‚·ãƒ³ãƒ—ãƒ«ã ãŒé…ããªã‚‹ã€‚ã€ŒLua Script and sorted sets data structure in Redisã€ã¨ã„ã†ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãŒæœ‰åã ã£ãŸã‚Šã™ã‚‹ã€‚

- åŒæœŸã®å•é¡Œã€‚Redis ç­‰ã‚’ centerized Data store ã¨ã—ã¦ä½¿ã†ã¨è‰¯ã„ã€‚å„ãƒ¬ãƒ¼ãƒˆãƒªãƒŸãƒƒã‚¿ãƒ¼ãŒåˆ¥ã€…ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’å‚ç…§ã—ã¦ã„ã‚‹çŠ¶æ…‹ã¯ã€ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ã˜ã‚ƒãªã„ã€‚

### ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

- ãƒ¬ãƒ¼ãƒˆãƒªãƒŸãƒƒãƒˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒé©åˆ‡ã‹ã©ã†ã‹è¦‹ãŸæ–¹ãŒã„ã„ã€‚

  - ä¾‹ãˆã°ã‚¿ã‚¤ãƒ ã‚»ãƒ¼ãƒ«ãªã©ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¹ãƒˆã«å¯¾å¿œã§ãã¦ã„ãªã„æ§˜ã ã£ãŸã‚‰ã€Token Bucket ã¸ã®å¤‰æ›´ã‚’è€ƒãˆã‚‹ãªã©ã€‚

- ãƒ¬ãƒ¼ãƒˆãƒªãƒŸãƒƒãƒˆã®ãƒ«ãƒ¼ãƒ«ãŒé©åˆ‡ã‹ã©ã†ã‹è¦‹ãŸæ–¹ãŒã„ã„ã€‚
  - é€šå¸¸ã®ç¯„å›²ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒè·³ã­ã‚‰ã‚Œã¦ã„ãŸã‚‰å•é¡Œã€‚

## step4. Wrap Up / 3~5 min

ä»¥ä¸‹ã®æ§˜ãªè©±é¡Œã‚’å‡ºã—ã¦ã‚‚ã„ã„ã€‚

- Hard vs soft rate limiting?
  - ãƒªãƒŸãƒƒãƒˆè¶…éã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯èªã‚ãªã„ã®ã‹ã€çŸ­æ™‚é–“ã ã‘èªã‚ã‚‹ã‹ã€‚
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ã‚¤ãƒ¤ãƒ¼ä»¥å¤–ã§ã®ãƒ¬ãƒ¼ãƒˆãƒªãƒŸãƒƒãƒˆã€‚
  - ex, Iptable (OSI layer 3)ã§ã® IP åˆ¶é™ã€‚
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®åŠ¹ç‡åŒ–
  - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’åˆ©ç”¨ã—ã¦ API call ã‚’æ¸›ã‚‰ã™
  - ãƒ¬ãƒ¼ãƒˆãƒªãƒŸãƒƒãƒˆã‚’ã‚³ãƒ¼ãƒ‰ã«ç¹”ã‚Šè¾¼ã‚€ã€‚429 ã‚’ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã™ã‚‹ã€‚

---

## ãƒ¬ãƒ¼ãƒˆãƒªãƒŸãƒƒãƒˆã®å„ç¨®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

::: details Token Bucket / Leaking Bucket / Fixed Window Counter / Sliding Window Log / Sliding Window Counter

## Token Bucket

- ãƒã‚±ãƒƒãƒˆã«æ±ºã‚ã‚‰ã‚ŒãŸæ™‚é–“ã«æ±ºã‚ã‚‰ã‚ŒãŸé‡ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è£œå……ã€‚ã‚­ãƒ£ãƒ‘ã‚ªãƒ¼ãƒãƒ¼ãªã‚‰è£œå……ã—ãªã„ã€‚ï¼ˆex, cap 4 ã®ãƒã‚±ãƒƒãƒˆã« 2 tokens/sec ã‚’è£œå……ã€‚ï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãŸã³ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¸€ã¤æ¶ˆè²»ã€‚ãƒˆãƒ¼ã‚¯ãƒ³ãŒè¶³ã‚Šãªã‘ã‚Œã° 429ã€‚
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ \* API Endpoint ã”ã¨ã«ãƒã‚±ãƒƒãƒˆã‚’ç”¨æ„ã™ã‚‹ã€‚

- pros
  - token ãŒæ®‹ã£ã¦ã„ã‚‹é™ã‚Šãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ãã‚‹ãŸã‚ã€çŸ­ã„ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã®ãƒãƒ¼ã‚¹ãƒˆã«å¯¾å¿œå¯èƒ½ã€‚
  - `token_count, last_refill_time, cap, rate`ã‚’ä¿æŒã™ã‚‹ã ã‘ã§ã„ã„ãŸã‚ã€ãƒ¡ãƒ¢ãƒªåŠ¹ç‡ãŒã„ã„ã€‚
- cons
  - ãƒã‚±ãƒƒãƒˆã®ã‚­ãƒ£ãƒ‘ã€ãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒªãƒ•ã‚£ãƒ«ãƒ¬ãƒ¼ãƒˆã®ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ãŒé›£ã—ã„ã€‚

## Leaking Bucket

- ã‚µã‚¤ã‚ºãŒè¨­å®šã—ã¦ã‚ã‚‹ FIFO ã‚­ãƒ¥ãƒ¼ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãŸã‚ã€ç­‰é–“éš”ï¼ˆex, 1 req/secï¼‰ã§å‡¦ç†ã—ã¦ã„ãã€‚ã‚­ãƒ¥ãƒ¼ãŒã„ã£ã±ã„ã®å ´åˆ 429ã€‚

- pros
  - ã‚­ãƒ¥ãƒ¼ã®ã‚µã‚¤ã‚ºä¸Šé™ã«ã‚ˆã‚Šãƒ¡ãƒ¢ãƒªåŠ¹ç‡ãŒã„ã„ã€‚
  - ç­‰é–“éš”ã§ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†ãŒå¿…è¦ãªå ´åˆã«é©ã—ã¦ã„ã‚‹ã€‚
- cons
  - å¤ã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã‚­ãƒ¥ãƒ¼ãŒã„ã£ã±ã„ã®æ™‚ã«ã€ãã‚Œä»¥é™ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå…¨ã¦å‡¦ç†ã•ã‚Œãªã„ã€‚
  - ã‚­ãƒ¥ãƒ¼ã®ã‚µã‚¤ã‚ºã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‡¦ç†ã®ãƒ¬ãƒ¼ãƒˆã®ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ãŒé›£ã—ã„ã€‚

## Fixed Window Counter

- æ™‚åˆ»ã‚’ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã«åˆ†å‰²ã€‚ï¼ˆex, 1:00 00~59, 1:01 00 ~59, ...ï¼‰ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã”ã¨ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¸Šé™ã¾ã§ã—ã‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ããªã„ã€‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã«ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’ãƒ—ãƒ©ã‚¹ã—ã€ä¸Šé™ã‚’è¶…ãˆã¦ã„ã‚Œã° 429ã€‚

- pros
  - `window_start, window_size, conter`ã ã‘ä¿æŒã™ã‚Œã°ã„ã„ã®ã§ãƒ¡ãƒ¢ãƒªåŠ¹ç‡ãŒã„ã„ã€‚
  - ä¸€å®šæ™‚é–“ã§ã‚¯ã‚©ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã§ãã‚‹ã€‚
- cons
  - ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¹ãƒˆã®éš›ã«ã€ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ i ã®çµ‚ã‚ã‚Šã€ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ i+1 ã®å§‹ã¾ã‚Šã‚’è¦‹ã‚‹ã¨ 100 req / 1 min ã®ã‚ˆã†ãªæ±ºã¾ã£ãŸãƒ¬ãƒ¼ãƒˆãƒªãƒŸãƒƒãƒˆã‚’è¶…ãˆã¦ã„ã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚

### Sliding Window Log

- ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ãƒ­ã‚°ã«è¨˜éŒ²ã™ã‚‹ã€‚2 req/min ã ã£ãŸå ´åˆã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ¥ãŸæ™‚ã«ç›´è¿‘ä¸€åˆ†ã®ãƒ­ã‚°ãŒ 1 å€‹ä»¥ä¸‹ãªã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€šã™ã€‚ãã†ã§ãªã„ãªã‚‰ãƒ­ã‚°ã‚’è¨˜éŒ²ã—ã¤ã¤ 429ã€‚ç›´è¿‘ä¸€åˆ†ã‚ˆã‚Šå‰ã®ãƒ­ã‚°ã¯å‰Šé™¤ã™ã‚‹ã€‚

- pros
  - æ­£ç¢ºãªãƒ¬ãƒ¼ãƒˆåˆ¶é™ã€‚ä¸Šè¨˜ä¾‹ã ã¨ã€ã©ã®ä¸€åˆ†ã‚’åˆ‡ã‚Šå–ã£ã¦ã‚‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ 2 ä»¶ä»¥ä¸Šå‡¦ç†ã•ã‚Œãªã„ã€‚
- cons
  - ãƒ¡ãƒ¢ãƒªåŠ¹ç‡ãŒæ‚ªã„ã€‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒãƒªã‚¸ã‚§ã‚¯ãƒˆã•ã‚Œã¦ã‚‚ãƒ­ã‚°ã«æ®‹ã‚‹ã€‚ãƒãƒ¼ã‚¹ãƒˆã®æ™‚ã«å¤§é‡ã®ãƒ­ã‚°ãŒæ®‹ã‚‹ã€‚

### Sliding Window Counter

- Fixed Window Counter ã¨åŒæ§˜ã«æ™‚åˆ»ã‚’ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã«åˆ†å‰²ã—ã€ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã”ã¨ã«ä¸Šé™ã¾ã§ã—ã‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ããªã„ã€‚ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã§ç®¡ç†ã€‚
- ãŸã ã—ã€ã‚ã‚‹ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§é–‹å§‹æ™‚åˆ»ã‹ã‚‰ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºã®ä¾‹ãˆã° 30%ã®æ™‚åˆ»ã«åˆ°é”ã™ã‚‹ã¾ã§ã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¸Šé™ãŒã€Œå‰ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®åˆè¨ˆ \* 70%ã€ã‚’å¼•ã„ãŸã‚‚ã®ã«ãªã‚‹ã€‚

- pros
  - Fixed Window Counter ã¨åŒæ§˜ã«ãƒ¡ãƒ¢ãƒªåŠ¹ç‡ãŒã„ã„ã€‚
  - Fixed Window Counter ã®ã€ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®å¢ƒç›®å‰å¾Œã§è¦‹ã‚‹ã¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¸Šé™ã‚’è¶…ãˆã‹ã­ãªã„å•é¡Œã‚’æ¦‚ã­å…‹æœã—ã¦ã„ã‚‹ã€‚
- cons
  - ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®å¢ƒç›®ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¸Šé™ã‚’è¶…ãˆãªã„ã“ã¨ã‚’å®Œå…¨ã«ã¯ä¿è¨¼ã—ã¦ã„ãªã„ã€‚ãŸã ã—ç†è«–ä¸Šã”ãã”ãä½ç¢ºç‡ã‚‰ã—ã„ã€‚

:::

# Chapter 5: Design Consistent Hashing

- åˆ†æ•£ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒãƒ¼ã¸ã®ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ãƒ»å–å¾—ã‚’è¡Œã†ã¨ãã€ãƒ‡ãƒ¼ã‚¿ã®ã‚­ãƒ¼ã‚’ãƒãƒƒã‚·ãƒ¥åŒ–ã—ãŸæ•°å­—ã‚’å…ƒã«ã‚µãƒ¼ãƒãƒ¼ã‚’æ±ºå®šã™ã‚‹ã€‚`severIdx := hash(key)%numOfServer`
- ã—ã‹ã—ã‚µãƒ¼ãƒãƒ¼ã®å°æ•°ã‚’å¢—æ¸›ã—ãŸå ´åˆã€å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã®å†é…ç½®ã‚’ä½™å„€ãªãã•ã‚Œã‚‹ã€‚
- **Consistent Hashing**ã¯ã€ã‚µãƒ¼ãƒãƒ¼å°æ•°ã®å¢—æ¸›æ™‚ã®å†é…ç½®ãŒ å¹³å‡ `numOfKey / numOfServer`ã§æ¸ˆã‚€ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã€‚
  - ãƒãƒƒã‚·ãƒ¥åŒ–ã•ã‚ŒãŸã‚­ãƒ¼ãŒå–ã‚Šã†ã‚‹å€¤ã®ãƒªã‚¹ãƒˆã®ã€å…ˆé ­ã¨æœ«å°¾ãŒã¤ãªãŒã£ãŸãƒ‡ãƒ¼ã‚¿æ§‹é€ ï¼ˆ**Hash Ring**ï¼‰ã‚’ç”¨æ„ã™ã‚‹ã€‚
  - å„ã‚µãƒ¼ãƒãƒ¼ã«ã¤ã„ã¦ã€IP ã‚„åå‰ã‚’ã‚‚ã¨ã«ãƒãƒƒã‚·ãƒ¥ã‚’ä½œæˆã—ã€Hash Ring ã®è©²å½“ã™ã‚‹ä½ç½®ã«ç›®å°ã‚’ã¤ã‘ã‚‹ã€‚
  - ä¿å­˜ã—ãŸã„ãƒ‡ãƒ¼ã‚¿ãŒæ¥ãŸã‚‰ã€ãƒãƒƒã‚·ãƒ¥ã‚­ãƒ¼ã®ä½ç½®ã‹ã‚‰æ™‚è¨ˆå›ã‚Šã§ Hash Ring ã‚’æ¢ç´¢ã—ã€æœ€åˆã«è¦‹ã¤ã‘ãŸã‚µãƒ¼ãƒãƒ¼ã«æ ¼ç´ã™ã‚‹ã“ã¨ã«ã™ã‚‹ã€‚
- Consistent Hashing ã®å•é¡Œ
  - Hash Ring ã¸ã‚µãƒ¼ãƒãƒ¼ã‚’åˆæœŸé…ç½®ã™ã‚‹ã¨ãã«ã€é–“éš”ãŒå‡ç­‰ã¨ã¯é™ã‚‰ãªã„ã€‚
  - ã‚µãƒ¼ãƒãƒ¼ã‚’æ¸›ã‚‰ã›ã° Hashi Ring ã§ãã®æ‰‹å‰ã«ä½ç½®ã™ã‚‹ã‚µãƒ¼ãƒãƒ¼ã¸ã®å‰²ã‚Šå½“ã¦ãŒå¢—ãˆã‚‹ã€‚é€†ã‚‚ç„¶ã‚Šã€‚å„ã‚µãƒ¼ãƒãƒ¼ã®å‰²ã‚Šå½“ã¦ã‚’å‡ç­‰ã«ä¿ã¤ã“ã¨ãŒã§ããªã„ã€‚
  - => **Virtual Node**ã‚’ Hash Ring ã«ã‚ˆã—ãªã«é…ç½®ã™ã‚‹ã“ã¨ã§ã€å„ã‚µãƒ¼ãƒãƒ¼ã¸ã®å‰²ã‚Šå½“ã¦ã‚’å‡ç­‰ã«ã™ã‚‹ã€‚Virtula Node ã¯æ—¢å­˜ã®ã„ãšã‚Œã‹ã®ã‚µãƒ¼ãƒã«ç´ã¥ãã‚‚ã®ã¨ã—ã€å„ã‚µãƒ¼ãƒãƒ¼ã® Original Node or Virtual Node ã®éš£æ¥ãƒãƒ¼ãƒ‰ã¨ã®è·é›¢ã®å’ŒãŒç­‰ã—ããªã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

# Chapter 6: Design A Key-value Store

- **CAP Theorem** (CAP å®šç†)
  - åˆ†æ•£ã‚·ã‚¹ãƒ†ãƒ ã«ãŠã„ã¦ã€ Consistencyï¼ˆæ•´åˆæ€§ï¼‰ã€ Availabilityï¼ˆå¯ç”¨æ€§ï¼‰ã€Partition Torelanceï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éšœå®³è€æ€§ï¼‰ã®ï¼“ã¤å…¨ã¦ã‚’å¶ãˆã‚‹ã“ã¨ã¯ã§ããšã€ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã«ãªã‚‹ã€‚
- ãƒ‡ãƒ¼ã‚¿åˆ†å‰²
  - Consistent Hash ã‚’ä½¿ãˆã°ã€ã‚µãƒ¼ãƒãƒ¼å°æ•°ã®å¢—æ¸›ãŒå¯èƒ½ã«ãªã‚Šã€ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã«ã‚‚å¯¾å¿œã§ãã‚‹ã€‚
  - æ€§èƒ½ã®é«˜ã„ã‚µãƒ¼ãƒãƒ¼ã«ã¯å¤šãã®ãƒãƒ¼ãƒãƒ£ãƒ«ãƒãƒ¼ãƒ‰ã‚’ç´ã¥ã‘ã‚‹ã“ã¨ã§ã€ã‚µãƒ¼ãƒãƒ¼ç¾¤ãŒ Heterogeneityï¼ˆç•°è³ªæ€§ï¼‰ã‚’æŒã¤ã“ã¨ã‚‚å¯èƒ½ã€‚
- ãƒ‡ãƒ¼ã‚¿ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
  - é«˜å¯ç”¨æ€§ã€ä¿¡é ¼æ€§ã®ãŸã‚ã«ãƒ‡ãƒ¼ã‚¿ã¯ä»»æ„ã®æ•°ã®ãƒãƒ¼ãƒ‰ã«è¤‡è£½ãŒå¿…è¦ã€‚ãƒ‡ãƒ¼ã‚¿ãŒæ ¼ç´ã•ã‚Œã‚‹ãƒãƒ¼ãƒ‰ã‹ã‚‰ Hash Ring ã‚’æ™‚è¨ˆå›ã‚Šã«æ¢ç´¢ã—ã€æœ€åˆã® N å€‹ã®ãƒãƒ¼ãƒ‰ã«è¤‡è£½ã™ã‚‹ã€‚
    - åŒã˜ã‚µãƒ¼ãƒãƒ¼ã«ç´ã¥ããƒãƒ¼ãƒãƒ£ãƒ«ãƒãƒ¼ãƒ‰ã¯ç„¡è¦–ã€‚
    - å„ã‚µãƒ¼ãƒãƒ¼ã¯åˆ¥ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ã«ã‚ã‚‹ã®ãŒç†æƒ³ã€‚
- æ•´åˆæ€§
  - 3 ç¨®é¡ã®ãƒ‘ãƒ©ãƒ¡ã‚¿ãƒ¼ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚æ•´åˆæ€§ã¨ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã«å½±éŸ¿ã€‚
    - `N`: num of replica nodes
    - `W`: write quorum. write operation must be acknowledged by W replicas
    - `R`: read quorum. read operation must be acknowledged by R replicas
      - `R = 1 && W = N`: fast read
      - `W = 1 && R = N`: fast write
      - `W + R > N`: strong consistency
  - æ•´åˆæ€§ãƒ¢ãƒ‡ãƒ«
    - å¼·ã„æ•´åˆæ€§ï¼šã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯å¸¸ã«æœ€æ–°ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹
    - å¼±ã„æ•´åˆæ€§: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯æœ€æ–°ã§ãªã„ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã†ã‚‹
    - çµæœæ•´åˆæ€§: ååˆ†ãªæ™‚é–“ã‚’ã‹ã‘ã¦ã€ã™ã¹ã¦ã®æ›´æ–°ã¯ä¼æ’­ã—æ•´åˆæ€§ãŒå–ã‚Œã‚‹
- ä¸æ•´åˆã®è§£æ¶ˆ: versioning
  -

# Chapter 7: Design A Unique Id Generator In Distributed Systems

# Chapter 8: Design A Url Shortener

# Chapter 9: Design A Web Crawler

# Chapter 10: Design A Notification System

# Chapter 11: Design A News Feed System

# Chapter 12: Design A Chat System

# Chapter 13: Design A Search Autocomplete System

# Chapter 14: Design Youtube

# Chapter 15: Design Google Drive

# Chapter 16: The Learning Continues
